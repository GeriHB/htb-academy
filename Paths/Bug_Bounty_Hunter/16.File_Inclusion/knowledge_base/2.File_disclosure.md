# File Disclosure

## Local File Inclusion

If the vulnerability exists we may read a file by specifying its absolute path.

For example on the following ip address:

`http://<SERVER_IP>:<PORT>/index.php?language=es.php`

We see that the language set here is `Spanish` and this url changed after we selected this language.

So, this means, it's reading a file `es.php`.

And here we can put a file that we want to read, for example `/etc/passwd`

`http://<SERVER_IP>:<PORT>/index.php?language=/etc/passwd`

### Path Traversal

The example above works if the whole input was used within the `include()` function, without any additions:

```php
include($_GET['language']);
```

But, this rarely happens, as devs append or prepend a string, for example `language` parameter can be used for a filename, and `languages` a directory in which the file is:

```php
include("./languages/" . $_GET['language']);
```

So, now if we put the whole path like in the example above, it would make it `./languages/etc/passwd` so it would be invalid.

But this can easily be bypassed by what is known as `path traversal`, so we will be using **relative paths**, and use the `../` to go to the parent directory.

And now this would work:
`http://<SERVER_IP>:<PORT>/index.php?language=../../../../etc/passwd`

If we are unsure how many `../` to put, we can add as much as we want, because even if we are in the `root` directory, doing a `../` would point to the root directory again.

### Filename Prefix

Sometimes there exists a filename prefix, which is added to the file that is accessed. For example:

```php
include("lang_", $_GET['language']);
```

And tin this case if we want to access `../../../etc/passwd` it will be `lang_../../../etc/passwd`, which makes it invalid

A way to bypass this is to include a `/` in the beginning of the filename that we want to access, which makes it `lang_/../../../etc/passwd`.

This only works if there is a directory `lang_` in the folder.

### Appended Extensions

A common example is when an extension is appended to the parameted:

```php
include($_GET['language'] . ".php");
```

So, whenever you want to access a file it will append the `php` extension in the end.

For example trying to access `/etc/passwd/` will make it `/etc/passwd.php` which is invalid.

### Second-Order Attacks

Occurs when a web app functionality insecurely pulls files from the backend server based on user-controlled parameters.

An example would be when a web app allows us to download the avatar `/avatar.png` and if we craft a malicious username like `../../../etc/passwd` we can grab it instead of the avatar.

This would poison the database with the payload in our username, and another app functionality would utilize this payload to perform the attack (download the avatar).

This is why it's called `Second-Order` attack.

