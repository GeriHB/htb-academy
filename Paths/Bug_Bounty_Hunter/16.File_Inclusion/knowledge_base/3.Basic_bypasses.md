# Basic Bypasses

## Non-Recursive Path Traversal Filters

One of the basic filters is to delete `../` substrings in order to avoid path traversals:

```php
$language = str_replace('../', ''. $_GET['language']);
```

This is quite insecure, because it doesn't remove recursively the `../` substring. 

It just runs a single time on the input and doesn't apply the filter on the output string.

So we can easily bypass this for example by putting `....//` and the filter would remove a `../` making it `../` as we want.

## Encoding

A better protection is by preventing characters like a `.` or `/` which are used for path traversal.

This can still be easily bypassed, by `url-encoding` the malicious string, which would remove all the `.` and `/`.

For example `../` would become `%2e%2e%2f`.

## Approved Paths

Some web apps may use Regular Expressions to make sure that the file is under a specific path, like for example under the `./languages` directory:

```php
if(preg_match('/^\.\/languages\/.+$/', $_GET['language'])) {
    include($_GET['language']);
} else {
    echo 'Illegal path specified!';
}
```

But still we can bypass this by matching this regex, and still going outside the directory.

For example: `index.php?language=./languages/../../../../etc/passwd`.

## Appended Extension

With modern versions of PHP, we can't bypass this, but still we can read files with that extension, for example for reading the source code.

### Path Truncuation

In older versions of PHP strings had a max length of 4096 characters, because of the 32-bit systems.

If longer string is passed, it would be `truncated` and anything after the max would be ignored.

PHP also used to remove dots and trailing slashes so calling `/etc/passwd/.` the `/.` would be truncated.

In both Linux and PHP multiple slashes and a current directory `.` in the middle of the path would be ignored, so `////etc/./passwd` is the same as `/etc/passwd/`,

If we combine both of these we can create very long strings pointing to the correct path, and when we reach 4096 characters the appended `.php` extension would be truncated.

`?language=non_existing_directory/../../../etc/passwd/./././.[./ REPEATED ~2048 times]`

### Null Bytes

PHP before 5.5 were vulnerabile to this. 

Meaning that adding a null byte `%00` would terminate the string and ignore everything after.

This is because of how strings are stored in low-level memory, where strings must use a null byte to indicate the end of the string (Assembly, C, C++).

So with `/etc/passwd%00` it would remove the appended extension `.php`