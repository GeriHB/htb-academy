# Running SQLMap on an HTTP Request

Has a number of options and switches that can be used to properly set the request before its usage.

On a lot of cases mistakes such as *forgetting to provide proper cookie values*, *overcomplicating setup with a lengthy command line*, *improper declaration of formatted POST data* can prevent detection and exploitation.

**Curl Commands**
Use the `Copy as cURL` option in the *Network* tab on the browser's developer tools.

Paste the content into the command line and change the command from `curl` to `sqlmap`.

**GET/POST Requests**
`GET` parameters are provided with the option `-u/--url`.
`POST` parameters need to use `--data`.

```sh
sqlmap 'http://example.com/' --data 'uid=1&name=test'
```

Here `uid` and `name` will be tested for the vulnerability - if we think that only `uid` can be vulnerable, we may use it by `-p uid`.

**Full HTTP Requests**
If we have a complex HTTP request with a lot of header values and an elongated `POST` body, we can use the `-r` flag.

In this case, SQLMap is provided with the `request file` which contains the whole HTTP request.

We can get this from `BURP` and *Copy to a file*:

```sh
sqlmap -r req.txt
```

**Custom SQLMap Requests**
Use a cookie:
```sh
sqllmap ... -cookie=...
```

Use of a header:
```sh
sqlmap ... -H=...
```

we can apply also `--host`, `--referer`, `-A/--user-agent`.

We can also randomize the *user-agent* by using `-random-agent`.

# Handling SQLMap Errors

**Display Errors** can be set on by using the `--parse-errors`, which will parse the DBMS errors and display them as part of the program.

**Traffic can be stored** by using the `-t` to store it to an output file.

**Verbose** `-v` option raises the verbosity level of the output.

**Proxy** `--proxy` redirects the whole traffic throgu a MiTM proxy like Burp.

# Attack Tuning

There are options to tune the SQLi attempts. Every payload consists of:
- vector - the central part of the payload which carries hte SQL code to be executed on the target.
- boundaries - are the suffix and prefix formations, which are used for proper injection of the vector into the vulnerable SQL statement.

## Prefix/Suffix

Sometimes there are some requirements for special prefix and suffix values, which can be done by using the options `--prefix` and `--suffix`:

```sh
sqlmap -u "www.example.com/?q=test" --prefix="%'))" --suffix="-- -"
```

This results on the enclosure of all vector values between the statix prefix and the suffix.

**Example**
Vulnerable target:
```php
$query = "SELECT id,name,surname FROM users WHERE id LIKE (('" . $_GET["q"] . "')) LIMIT 0,1";
$result = mysqli_query($link, $query);
```

Vector - `UNION ALL SELECT 1,2,VERSION()` bounded with the prefix and the suffix will result in the following valid SQL statement:

```sql
SELECT id,name,surname FROM users WHERE id LIKE (('test%')) UNION ALL SELECT 1,2,VERSION()-- -')) LIMIT 0,1
```

## Leve/Risk

There's a possibility to use bigger sets of boundaries and vectors, already incorporated into the SQLMap.

For this, `--level` and `--risk` shoud be used:
- `--level` (1-5, default=1) extends vectors and boundaries based ontheir expectancy of success (higher level -> lower expectancy).
- `--risk` (1-3, default=1) extends the used vector set based on their risk of causing problems at the target (db entry loss, DoS).

For example `OR` payloads are dangerous in a default run, so where the usage of it is a must, the risk level has to be raised.

