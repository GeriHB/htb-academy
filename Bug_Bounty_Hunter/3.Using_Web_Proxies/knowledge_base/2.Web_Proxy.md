# Web Proxy

## Intercepting Requests

Burp: `Proxy -> Intercept` and then go to the browser. If the intercept is on it will take the request, and wait for us to press *forward* to send the request.

ZAP: Click the green button and the interception is on.

## Intercepting Responses

Sometimes we may need to intercept responses, for examlpe when we want to change how a page looks like, enabling a disabled field, or showing hidden fields.

Burp: `Proxy -> Options` and enable *Intercept Response* under *Intercept Server Responses*.

Now when we refresh the page, and go to the Burp we see the intercepted request, click on *forward* and there will be the intercepted response, normally a `html` file.

There for example we can modify the input type to text, and then the `ping` web page can contain also text, not just numbers.

```html
<input type="text" id="ip" name="ip" min="1" max="255" maxlength="100"
    oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
    required>
```

## Automatic Modification

**Request**
Sometimes we want some modofication to all outgoing HTTP requests and all incoming HTTP responses.

For example match any text within the request, and replace with a different text.

Burp: `Proxy -> Options -> Match and Replace` and as an example:

Match: `^User-Agent.*$` and Replace: `User-Agent: HackTheBox Agent 1.0`, and Type: `Request header`

**Response**
Is the same process, just change the Type: `Response body` and the desired modifications.

`Burp Repeater` is a very powerful tool, which takes a request that we send there, and we can modify itt and send to test it all our modifications.

On Burp we can also **Encode and Decode** strings by using the **Decoder** tool.

## Proxying Tools

We can also use the web proxies by enabling the interception of requests by command-line tools.

**Proxychains**
It routes all traffic ocmming from any command-line tool to any proxy we specify.

It adds a proxy to any command-line tool and is the simpliest and easiest method to route web traffic of command-line tools through our web proxies.

To use it we have to edit `/etc/proxychains.conf`, comment out the final line and add the line in the end.

```sh
#socks4         127.0.0.1 9050
http 127.0.0.1 8080
```

To reduce noise we can un-comment `quite_mode`, and once this is done we can prepend `proxychains` to any command and the traffic will be routed through `proxychains`.

```sh
curl http:server:port
```

And so we can see it now on Burp.

**Nmap**
```sh
nmap --proxies http://127.0.0.1:8080 IP_address -pPort -Pn -sC
```

`-Pn` flag skips host discovery, and `-sC` examines what an nmap script scan does.

**Metasploit**
This can be done by using `set PROXIES`, for example:

```sh
msfconsole
use ...
set PROXIES HTTP:127.0.0.1:8080
...
```

