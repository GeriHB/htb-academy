# Filter Evasion

A method of injection mitigation is to blacklist characters and words on the back-end.

Another layer is teh WAFs.

## Filter/WAF Detection

In the example from the labs 1-3 we had a webpage to ping an address, which we did with Burp.

Now, if we try the same behavior we got an error: `Invalid input`. 

The error was shown on the field where the output is displayed, which means that it was prevented by the `PHP` web app.

If it would be displayed on a different page, with information like the IP, this indicates that it was the work of a WAF.

Let's send the payload:

```sh
127.0.0.1; whoami
```

The case here is:
- blacklisted character or
- blacklisted command.

**Blacklisted character**

Let's try to add a character at a time, for example `127.0.0.1;`.

We get again an `invalid input` which means that the semi-colon is blacklisted.

## Bypassing Blacklisted Operators

Usually the new-line character is not blacklisted. This character works in appending our commands both in Linux and on Windows.

From the Lab #4 let's try the following by adding a space character:

```sh
ip=127.0.0.1%0a+whoami
```

and now we got an `invalid input` meaning that we have other filters to bypass.

Even after removing the `whoami` we got an `invalid input`.

So, this tells us that the space character is blacklisted as well. 

A technique that may work to bypass this is by using tabs `%09` instead of space.

**Using $IFS**

**$IFS** is a Linux Environment Variable may also work since its default value is `a space and a tab`.

So if we use it, the variable should be automatically replaced with a `space`.

**Using Brace Explansion**

To bypass the space character we can also use the `Bash Brace Explansion` feature, which adds spaces between arguments wrapped between braces:

```sh
{ls,-la}

total 0
drwxr-xr-x 1 21y4d 21y4d   0 Jul 13 07:37 .
drwxr-xr-x 1 21y4d 21y4d   0 Jul 13 13:01 ..
```

**Other Blacklisted Characters**

A common blacklisted character is the slash `/` or backslash `\`.

**Linux**

To replace slashes we can use `Linux Environment Variables`, even thought for the slash there is no such variable.

But they can be used in an environment variable, and we can specify `start` and `length` of the string to match this character.

For example:

```sh
echo ${PATH}
/usr/local/bin:/usr/bin:/bin:/usr/games
```

So, since we need the slash `/` we start at the character `0` with a length of `1`, to get only the slash.

```sh
echo ${PATH:0:1}
/
```

To get the semicolon `;`:

```sh
echo ${LS_COLORS:10:1}
```

**Windows**

The same concept works for Windows.

Echo a Windows variable and get the backslash:

```ps
$env:HOMEPATH[0]

\
```



ip=127.0.0.1%0a%09ls%09echo%09${PATH:0:1}home%09${PATH:0:1}