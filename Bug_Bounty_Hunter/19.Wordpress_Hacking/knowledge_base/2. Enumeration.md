An essential part is uncovering the software version number. 

We an search for **meta generator** tag using the `cURL` with `grep` to filter for the information.

```sh
curl -s -X GET http://website.com | grep '<meta name="generator"'
```

The source code can also contain comments that can be useful. Links to CSS and JS can also provide hints about the version number.

In older versions, version information could be found also on the `readme.html` in root directory.

## Plugins and Theme Enumeration

Source code can provide also such information.

Plugins:
```sh
curl -s -X GET http://blog.inlanefreight.com | sed 's/href=/\n/g' | sed 's/src=/\n/g' | grep 'wp-content/plugins/*' | cut -d"'" -f2
```

Themes:
```sh
curl -s -X GET http://blog.inlanefreight.com | sed 's/href=/\n/g' | sed 's/src=/\n/g' | grep 'themes' | cut -d"'" -f2
```

But, not all of them can be found passively, so we may need to send requests to the servers actively to enumerate them.

This can be done by sending a `GET` request that points to a directory or file that exists on the server. If it does, we will either:
- Gain access 
- Or receive a redirect response indicating that it does exist.

Plugins Active Enumeration
```sh
curl -I -X GET http://blog.inlanefreight.com/wp-content/plugins/mail-masta

HTTP/1.1 301 Moved Permanently
Date: Wed, 13 May 2020 20:08:23 GMT
Server: Apache/2.4.29 (Ubuntu)
Location: http://blog.inlanefreight.com/wp-content/plugins/mail-masta/
Content-Length: 356
Content-Type: text/html; charset=iso-8859-1
```

If it doesn't we will receive a `404`:
```sh
curl -I -X GET http://blog.inlanefreight.com/wp-content/plugins/someplugin

HTTP/1.1 404 Not Found
Date: Wed, 13 May 2020 20:08:18 GMT
Server: Apache/2.4.29 (Ubuntu)
Expires: Wed, 11 Jan 1984 05:00:00 GMT
Cache-Control: no-cache, must-revalidate, max-age=0
Link: <http://blog.inlanefreight.com/index.php/wp-json/>; rel="https://api.w.org/"
Transfer-Encoding: chunked
Content-Type: text/html; charset=UTF-8
```

For this we can use tools such as `wfuzz` or `WPScan` to automate the process.

## Directory Indexing

Even if a plugin is deactivated, it can be still accessible, and we can gain access to its scripts and functions.

Best practice - **remove or update** any unused plugins.

We can view the directory listing using `cURL` and output it to a nice readable format `html2text`.

```sh
curl -s -X GET http://blog.inlanefreight.com/wp-content/plugins/mail-masta/ | html2text

****** Index of /wp-content/plugins/mail-masta ******
[[ICO]]       Name                 Last_modified    Size Description
===========================================================================
[[PARENTDIR]] Parent_Directory                         -  
[[DIR]]       amazon_api/          2020-05-13 18:01    -  
[[DIR]]       inc/                 2020-05-13 18:01    -  
[[DIR]]       lib/                 2020-05-13 18:01    -  
[[   ]]       plugin-interface.php 2020-05-13 18:01  88K  
[[TXT]]       readme.txt           2020-05-13 18:01 2.2K  
===========================================================================
     Apache/2.4.29 (Ubuntu) Server at blog.inlanefreight.com Port 80
```

## User Enumeration

If we get the list of users, we can try to guess default credentials or do a brute force attack.

There are two methods to do this:

**First Method**
Review posts to uncover the ID assigned to the user and their corresponding username.

If we mouse over the post author, a link to the user's account appears in the web browser's lower-left cornet.

The `admin` is usually assigned with the user ID `1`, and this can be confirmed by specifying the ID for the author parameter in the URL

```sh
http://website.com/?author=1
```

Existing user:
```sh
curl -s -I http://blog.inlanefreight.com/?author=1

HTTP/1.1 301 Moved Permanently
Date: Wed, 13 May 2020 20:47:08 GMT
Server: Apache/2.4.29 (Ubuntu)
X-Redirect-By: WordPress
Location: http://blog.inlanefreight.com/index.php/author/admin/
Content-Length: 0
Content-Type: text/html; charset=UTF-8
```

Non-Existing user:
```sh
curl -s -I http://blog.inlanefreight.com/?author=100

HTTP/1.1 404 Not Found
Date: Wed, 13 May 2020 20:47:14 GMT
Server: Apache/2.4.29 (Ubuntu)
Expires: Wed, 11 Jan 1984 05:00:00 GMT
Cache-Control: no-cache, must-revalidate, max-age=0
Link: <http://blog.inlanefreight.com/index.php/wp-json/>; rel="https://api.w.org/"
Transfer-Encoding: chunked
Content-Type: text/html; charset=UTF-8
```

**Second Method**
It requires interaction with the `JSON` endpoint, which allows to get the list of users.

Is is changed in WP core after `4.7.1` and later versions only show if a user is configured or not.

```sh
curl http://blog.inlanefreight.com/wp-json/wp/v2/users | jq

[
  {
    "id": 1,
    "name": "admin",
    "url": "",
    "description": "",
    "link": "http://blog.inlanefreight.com/index.php/author/admin/",
    <SNIP>
  },
  {
    "id": 2,
    "name": "ch4p",
    "url": "",
    "description": "",
    "link": "http://blog.inlanefreight.com/index.php/author/ch4p/",
    <SNIP>
  },
<SNIP>
```

## Login

When we have the list of users, we can brute-force, which can be done via the login page or the `xmlrpc.php`.

If the `POST` request against `xmlrpc.php` has valid credentials, we will receive the following output:

```sh
curl -X POST -d "<methodCall><methodName>wp.getUsersBlogs</methodName><params><param><value>admin</value></param><param><value>CORRECT-PASSWORD</value></param></params></methodCall>" http://blog.inlanefreight.com/xmlrpc.php

<?xml version="1.0" encoding="UTF-8"?>
<methodResponse>
  <params>
    <param>
      <value>
      <array><data>
  <value><struct>
  <member><name>isAdmin</name><value><boolean>1</boolean></value></member>
  <member><name>url</name><value><string>http://blog.inlanefreight.com/</string></value></member>
  <member><name>blogid</name><value><string>1</string></value></member>
  <member><name>blogName</name><value><string>Inlanefreight</string></value></member>
  <member><name>xmlrpc</name><value><string>http://blog.inlanefreight.com/xmlrpc.php</string></value></member>
</struct></value>
</data></array>
      </value>
    </param>
  </params>
</methodResponse>
```

If not:
```sh
curl -X POST -d "<methodCall><methodName>wp.getUsersBlogs</methodName><params><param><value>admin</value></param><param><value>asdasd</value></param></params></methodCall>" http://blog.inlanefreight.com/xmlrpc.php

<?xml version="1.0" encoding="UTF-8"?>
<methodResponse>
  <fault>
    <value>
      <struct>
        <member>
          <name>faultCode</name>
          <value><int>403</int></value>
        </member>
        <member>
          <name>faultString</name>
          <value><string>Incorrect username or password.</string></value>
        </member>
      </struct>
    </value>
  </fault>
</methodResponse>
```

## Using WPScan

It is an automated scanner and enumeration tool, which determines if themes and plugins are outdated or vulnerable.

It can pull in vulnerability information from external sources to enhance the scans, like for example obtaining an API from `WPVulnDB` which is used by WPScan for vulnerability and exploit POC and reports.

The free plan allows up to 50 requests per day, and to use the database, we need just to create an account and copy the API token from the users page, and then supplied using the `--api-token` parameter.

## WPScan Enumeration

`--enumerate` by default it enumerates vulnerable plugins, themes, users, media, and backups.

We can restrict the enumeration only specific components such as plugins by `--enumerate ap`.

```sh
wpscan --url http://blog.inlanefreight.com --enumerate --api-token Kffr4fdJzy9qVcTk
```

