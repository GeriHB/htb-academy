# Deobfuscation Examples

## Code Analysis

In the last lab we deobfusacted the code:

```js
function generateSerial()
	{
	var flag="HTB
		{
		1_4m_7h3_53r14l_g3n3r470r!
	}
	";
	var xhr=new XMLHttpRequest();
	var url="/serial.php";
	xhr.open("POST",url,true);
	xhr.send(null)
}
```

Let's analyze each line of the only function here `generateserial()`.

The variable `xhr` creates an `XMLHttpRequest` object.

Analyzing code comes with a lot of reading and searching, because we have to see what and how a lot of methods and functions do.

This one here handles web requests.

The second variable `url` has a URL to `/serial.php`.

**Functions**
Then the function `xhr.open` is called with `POST` and `url`, so this opens an HTTP request to the url.

And then the `xhr.send` sends the request.

So simply, the `generateSerial` just sends a `POST` request to `/serial.php` but without any `POST` data.

Devs maybe implemented it for when they need to generate a serial, when clickin on a button, but no such elements were on the webpage, so maybe is for future use.

We can also check now if it's handled on the `server-side` when sending a `POST` request, and if it is so, we may have uncovered an unreleased functionality - usually have bugs and vulnerabilities.

**HTTP Requests**

Now let's try this using `curl`.

We can send a `POST` request with the data by typing:

```sh
curl -s http://server:port/ -X POST -d "param=value"
```

## Decoding

The most common used text encoding methods are:
- base64
- hex
- rot13

**Base64**
Usually reduces the use of special characters - is represented in alpha-numeric characters, in adition to `+` and `/`.

The most distinctive feature is the padding using `=`.

The length is a multiple of 4, and if it is for example 3 characters long an `=` is added.

Encode:
```sh
echo Halil | base64
```

Decode
```sh
echo aGFsaWwK | base64 -d
```

**Hex**
Encodes the characters into its `hex` order in the `ACII` table.

a - 51, b - 62, c - 63, etc.

To spot it just see if the string is made of only hex characters: `0-9 and a-f`.

Encode:
```sh
echo Halil | xxd -p
```

Decode:
```sh
echo 48616c696c0a | xxd -p -r
```

**Caesar/Rot13**
Very old encoding technique - shifts each letter by a fixed number.

For example if by 1, the a -> b, b -> c, etc.

To spot it look for patters, because each character is just simply replaced with another one, and is always the same one.

There is not a command to do this, but can be created.

Encode:
```sh
echo Halil | tr 'A-Za-z' 'N-ZA-Mn-za-m'
```

Decode with the same command:
```sh
echo Unyvy | tr 'A-Za-z' 'N-ZA-Mn-za-m'
```





